---
import { Image } from 'astro:assets';
import { frame, type FrameProps } from './frame';

type Props = FrameProps & {
  image: {
    src: string;
    alt: string;
  };
  caption?: string;
};

const { image, caption } = Astro.props;

const images = import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/images/content/**/*.{jpeg,jpg,png,gif}',
);
if (!images[image.src])
  throw new Error(
    `"${image.src}" does not exist in glob: "src/assets/images/content/**/*.{jpeg,jpg,png,gif}"`,
  );
const imageData = (await images[image.src]()).default;
---

{
  image && (
    <figure>
      <Image
        class:list={[frame(Astro.props)]}
        src={imageData.src}
        alt={image.alt}
        width={imageData.width}
        height={imageData.height}
      />
      {caption && <figcaption class='pl-4 pt-1'>{caption}</figcaption>}
    </figure>
  )
}
